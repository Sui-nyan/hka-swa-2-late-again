generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model SimplifiedStation {
  evaNumber             Int @id
  name                  String
  productLine           String
  lat Int
  long Int
}

model Station {
  eva   Int      @id
  name  String
  ds100 String   @unique // Station Code
  meta  String[]// Eva station numbers of connected stations
  p     String[]// platforms
  isDb  Boolean  @default(false)

  plans Plan[]
}

model Plan {
  id             Int      @id @default(autoincrement()) // "RequestId"
  eva            Int
  targetDatetime String
  createdAt      DateTime @default(now())

  stops   Stop[]
  station Station @relation(references: [eva], fields: [eva])

  @@unique([eva, targetDatetime])
}

model Stop {
  id   String     @id
  ar   Arrival?
  dp   Departure?
  tl   TrainInfo? @relation(fields: [trainInfoId], references: [id])
  plan Plan       @relation(fields: [planId], references: [id])

  trainInfoId Int
  planId      Int
}

model Arrival {
  pt   DateTime // planned time
  ppth String[] // planned path

  // Backlinks
  stop   Stop   @relation(fields: [stopId], references: [id])
  stopId String @unique
}

model Departure {
  pt   DateTime // planned time
  ppth String[] // planned path

  // Backlinks
  stop   Stop   @relation(fields: [stopId], references: [id])
  stopId String @unique
}

model TrainInfo {
  id Int @id @default(autoincrement())

  c String?
  n String?
  f String? // FilterFlag
  o String? // Owner
  t String? // triptype

  stops Stop[]
}

// // ============================================================================
// // TIMETABLE MODELS (from DB_API schema)
// // ============================================================================

// model Timetable {
//     id        String          @id @default(cuid())
//     eva       BigInt
//     station   String
//     messages  Message[]
//     stops     TimetableStop[]
//     createdAt DateTime        @default(now())
// }

// model TimetableStop {
//     id          String    @id
//     eva         BigInt
//     timetable   Timetable @relation(fields: [timetableId], references: [id])
//     timetableId String
//     arrival     Event?    @relation("arrival")
//     departure   Event?    @relation("departure")

//     connections             Connection[]
//     messages                Message[]
//     historicDelays          HistoricDelay[]
//     historicPlatformChanges HistoricPlatformChange[]
//     reference               Reference?
//     referenceTripRelations  ReferenceTripRelation[]
//     tripLabel               TripLabel?   

//     @@unique([id, timetableId])
// }

// model Event {
//     id              String         @id @default(cuid())
//     cde             String? // Changed distant endpoint
//     clt             String? // Cancellation time (YYMMddHHmm format)
//     cp              String? // Changed platform
//     cpth            String? // Changed path
//     cs              String? // Event status (p=PLANNED, a=ADDED, c=CANCELLED)
//     ct              String? // Changed time (YYMMddHHmm format)
//     dc              Int? // Distant change
//     hi              Int? // Hidden flag
//     l               String? // Line
//     pde             String? // Planned distant endpoint
//     pp              String? // Planned platform
//     ppth            String? // Planned path
//     ps              String? // Planned status
//     pt              String? // Planned time (YYMMddHHmm format)
//     tra             String? // Transition trip id
//     wings           String? // Wing trip ids
//     messages        Message[]
// }

// model Message {
//     id          String               @id @default(cuid())
//     c           Int? // Code
//     cat         String? // Category
//     del         Int? // Deleted
//     dm          DistributorMessage[]
//     ec          String? // External category
//     elnk        String? // External link
//     ext         String? // External text
//     from        String? // Valid from (YYMMddHHmm format)
//     int         String? // Internal text
//     o           String? // Owner
//     pr          String? // Priority (1=HIGH, 2=MEDIUM, 3=LOW, 4=DONE)
//     t           String // Message type (h=HIM, q=QUALITY_CHANGE, f=FREE, d=CAUSE_OF_DELAY, i=IBIS, u=UNASSIGNED_IBIS, r=DISRUPTION, c=CONNECTION)
//     tl          TripLabel[]
//     to          String? // Valid to (YYMMddHHmm format)
//     ts          String // Timestamp (YYMMddHHmm format)
//     timetable   Timetable          
//     stop        TimetableStop?   
//     event       Event?         
// }

// model DistributorMessage {
//     id        String  @id @default(cuid())
//     int       String? // Internal text
//     n         String? // Distributor name
//     t         String? // Distributor type (s=CITY, r=REGION, f=LONG_DISTANCE, x=OTHER)
//     ts        String? // Timestamp (YYMMddHHmm format)
//     message   Message
// }

// model TripLabel {
//     id      String         @id @default(cuid())
//     c       String // Category (e.g. ICE, RE)
//     f       String? // Filter flags
//     n       String // Train number
//     o       String // Owner
//     t       String? // Trip type (p, e, z, s, h, n)
//     message Message?      
//     stop    TimetableStop?
// }

// model Connection {
//     id  String         @id @default(cuid())
//     cs  String // Connection status (w=WAITING, n=TRANSITION, a=ALTERNATIVE)
//     eva BigInt
//     ts  String // Timestamp (YYMMddHHmm format)
//     s   TimetableStop? // Reference to connected stop
//     ref TimetableStop? // Reference stop
// }

// model HistoricDelay {
//     id   String        @id @default(cuid())
//     ar   String? // Arrival event (YYMMddHHmm format)
//     cod  String? // Detailed description of delay cause
//     dp   String? // Departure event (YYMMddHHmm format)
//     src  String? // Delay source (L, NA, NM, V, IA, IM, A)
//     ts   String // Timestamp (YYMMddHHmm format)
//     stop TimetableStop
// }

// model HistoricPlatformChange {
//     id   String        @id @default(cuid())
//     ar   String? // Arrival platform
//     cot  String? // Detailed cause of track change
//     dp   String? // Departure platform
//     ts   String // Timestamp (YYMMddHHmm format)
//     stop TimetableStop
// }

// model Reference {
//     id   String        @id @default(cuid())
//     tl   TripLabel? 
//     rt   TripLabel[] 
//     stop TimetableStop
// }

// model ReferenceTripRelation {
//     id   String        @id @default(cuid())
//     rt   ReferenceTrip
//     rts  String // Reference trip status (b=BEFORE, e=END, c=BETWEEN, s=START, a=AFTER)
//     stop TimetableStop
// }

// model ReferenceTrip {
//     id     String             @id @default(cuid())
//     c      Boolean // Cancellation flag
//     tripId String // Id
//     rtl    ReferenceTripLabel
//     ea     ReferenceTripStop
//     sd     ReferenceTripStop
// }

// model ReferenceTripStop {
//     id  String @id @default(cuid())
//     eva BigInt
//     i   Int // Index
//     n   String // Name
//     pt  String // Planned time (YYMMddHHmm format)
// }

// model ReferenceTripLabel {
//     id String @id @default(cuid())
//     c  String // Category
//     n  String // Train number
// }
